// room script file
function oGloink1_Interact()
{
    oGloink1.Visible = false;
    oGloink1.Clickable = false;
    StartDialogue(0 ,  "¡Anda!");
    EndDialogue(true);    
    GloinksCaptured += 1;
    
    if(GloinksCaptured == 1){ cPlayer.AddInventory(iGloinks); }
}
function oGloink2_Interact()
{
    oGloink2.Visible = false;
    oGloink2.Clickable = false;
    StartDialogue(0 ,  "¡Anda!");
    EndDialogue(true);
    GloinksCaptured += 1;
    
    if(GloinksCaptured == 1){ cPlayer.AddInventory(iGloinks); }
}
function oGloink3_Interact()
{
    oGloink3.Visible = false;
    oGloink3.Clickable = false;
    StartDialogue(0 ,  "¡Anda!");
    EndDialogue(true);
    GloinksCaptured += 1;
    
    if(GloinksCaptured == 1){ cPlayer.AddInventory(iGloinks); }
}

function oGloink4_Interact()
{
    oGloink4.Visible = false;
    oGloink4.Clickable = false;
    StartDialogue(0 ,  "¡Anda!");
    EndDialogue(true);
    GloinksCaptured += 1;
    
    if(GloinksCaptured == 1){ cPlayer.AddInventory(iGloinks); }
}

function oGloink5_Interact()
{
    oGloink5.Visible = false;
    oGloink5.Clickable = false;
    StartDialogue(0 ,  "¡Anda!");
    EndDialogue(true);
    GloinksCaptured += 1;
    
    if(GloinksCaptured == 1){ cPlayer.AddInventory(iGloinks); }
}

function oGloink6_Interact()
{
    oGloink6.Visible = false;
    oGloink6.Clickable = false;
    StartDialogue(0 ,  "¡Anda!");
    EndDialogue(true);
    GloinksCaptured += 1;
    
    if(GloinksCaptured == 1){ cPlayer.AddInventory(iGloinks); }
}

function oGloink7_Interact()
{
  MovePlayerAndWait(889, 280, eDirectionRight);
  CanPlayerMove=true;
  
  if(glueProcess == 2 && oGloink7.Y == 281){
    oGloink7.Visible = false;
    oGloink7.Clickable = false;
    StartDialogue(0 ,  "¡Anda!");
    EndDialogue(true);
    GloinksCaptured += 1;
    if(GloinksCaptured == 1){ cPlayer.AddInventory(iGloinks); }
  }else{
    StartDialogue(0, "¡AGH! Se mueve mucho para cogerlo.");
    EndDialogue(true);
  }
}

float gloink7YForce;
bool chasing;
int queenProgress = -500;
int queenY = 445;
bool gotKilled;
function room_RepExec()
{
  gloink7YForce++;
  oGloink7.Y += FloatToInt(gloink7YForce);
  if(oGloink7.Y >= 280){ if(glueProcess != 2){gloink7YForce = -20.0;} oGloink7.Y = 281;}
  
  if(chasing){
    queenProgress += 3;
    
    if(oQueen.X + 640 > cPlayer.x){
      cPlayer.Transparency=100;
      StartDialogue(7, "FIN DEL JUEGO\nLa reina Gloink te aplastó.");
      EndDialogue(true);
      gotKilled=true;
      cPlayer.ChangeRoom(3, 312, 430);
    }
    
    if(cPlayer.x > 1297){
      cKinger.Transparency=100;
      cGangle.Transparency=100;
    }
  }
  
  oQueen.X = queenProgress + Random(15) - Random(15);
  oQueen.Y = queenY + Random(15) - Random(15);
}

function oGlueBucket_Look()
{
  StartDialogue(0, "Un bote de pegamento");
  EndDialogue(true);
}

function oGlueBucket_Interact()
{
  MovePlayerAndWait(310, 303, eDirectionUp);
  oGlueBucket.Visible=false;
  glueProcess = 1;
  StartDialogue(0, "Genial, podré usar esto para pegar al saltarín al suelo.");
  
  player.AddInventory(iGlue);
  EndDialogue(true);
}

function hGlue_Interact()
{
  if(glueProcess != 1){return;}
  if(player.ActiveInventory != iGlue){return;}
  
  MovePlayerAndWait(850, 282, eDirectionRight);
  CanPlayerMove=true;
  glueProcess = 2;
  oGluePuddle.Visible=true;
  player.LoseInventory(iGlue);
  
}

function hGloinksPlace_Look()
{
  StartDialogue(0, "Aquí es donde debo dejarlos a todos.");
  EndDialogue(true);
}

function ChaseStart(){
  gInventoryTab.Visible =false;
  gInventoryTab.Clickable = false;
  player.LoseInventory(iGloinks);
  cPlayer.Walk(312, 430);
  
  StartDialogue(0, "Listo, ahí están todos.");
  StartDialogue(4, "Genial, buen trabajo.");
  StartDialogue(4, "Ya podemos volver a la superficie.");
  aDIGITAL_CIRCUS_11.Stop();
  StartDialogue(7, "Grrrr....");
  StartDialogue(0, "...");
  StartDialogue(4, "...");
  StartDialogue(3, "...");
  StartDialogue(3, "¿Qué fue eso?");
  oQueen.Transparency=0;
  aDIGITAL_CIRCUS_Reina.Play(eAudioPriorityHigh);
  StartDialogue(8, "¡¡GRAAAAAHHHHH!!");
  StartDialogue(4, "¡¡¡¡¡HHAAAAA!!!!!");
  StartDialogue(4, "¡¡LA REINA GLOINK!!");
  StartDialogue(8, "¡NO SOIS GLOINKS!");
  StartDialogue(8, "¡TOOOOOOOOODOOO DEBES SER GLOINK!");
  StartDialogue(8, "¡VENID AQUÍ!");
  StartDialogue(4, "¡¡¡CORRED!!!");
  EndDialogue(true);
  
  chasing = true;
  
  cKinger.SetWalkSpeed(64,  64);
  cGangle.SetWalkSpeed(64,  64);
  cKinger.Walk(1962, 370);
  cGangle.Walk(1962, 370);
  cPlayer.SetWalkSpeed(12,  12);
  cPlayer.Walk(552, 397);
  Mouse.Mode = eModeWalkto;
  
  oDoor.Visible=true;
}

function hGloinksPlace_UseInventory()
{
  if(player.ActiveInventory == iGloinks){
  if(GloinksCaptured == 7){
    
    gloinksGroup.Visible = true;
    ChaseStart();
    
  }else{
    int left = 7 - GloinksCaptured;
    
    if(left == 1){
      StartDialogue(0, "Aún me falta 1");
    }
    else{
      StartDialogue(0, String.Format("Aún me faltan %d",  left));
    }
    
    EndDialogue(true);
  }
}
}


function ResetAll(){
      queenProgress= -500;
      oQueen.X = queenProgress;
      cKinger.Transparency=0;
      cGangle.Transparency=0;
      cKinger.x = 421;
      cKinger.y = 401;
      cKinger.Walk(421, 401);
      cGangle.x = 207;
      cGangle.y = 409;
      cGangle.Walk(207, 409);
      cKinger.FaceDirection(eDirectionDown);
      cGangle.FaceDirection(eDirectionDown);
      chasing = false;
      cPlayer.Transparency=0;
      gloinksGroup.Visible = false;
      
      if(gotKilled){
        GloinksCaptured=7;
        player.AddInventory(iGloinks);
      }
}


function Room_Load(){
  
  ResetAll();
  
  gInventoryButton.Clickable = true;
  gInventoryButton.Visible = true;
  gInventoryTab.Clickable = false;
  gInventoryTab.Visible = false;
  cGangle.ManualScaling = true;
  cGangle.Scaling = 70;
  cKinger.ManualScaling = true;
  cKinger.Scaling = 160;
  oQueen.Transparency=100;
  oQueen.X = queenProgress;
  oQueen.Y = queenY;
  oDoor.Visible=false;
  aDIGITAL_CIRCUS_11.Play(eAudioPriorityHigh);
  }

function hDoor_WalkOn()
{
  if(!chasing){return;}
  cPlayer.StopMoving();
  StartDialogue(0, "¡OH! ¡La salida!");
  StartDialogue(0, "Espero que Gangle y Kinger hayan salido por aquí.");
  EndDialogue(false);
  cPlayer.ChangeRoom(4, 308, 273, eDirectionDown);
}

